<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jarvis 2.0 - Your AI Assistant</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0b0f17;
      color: #c9d1d9;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }
    .container {
      text-align: center;
      width: 100%;
      max-width: 700px;
      background: rgba(15, 20, 30, 0.9);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(88, 166, 255, 0.3);
    }
    h1 {
      color: #58a6ff;
      text-shadow: 0 0 10px #58a6ff;
      font-size: 1.5rem;
    }
    #response {
      margin-top: 20px;
      background-color: #161b22;
      padding: 15px;
      border-radius: 10px;
      min-height: 100px;
      box-shadow: inset 0 0 10px rgba(255,255,255,0.1);
      overflow-y: auto;
      max-height: 300px;
    }
    button {
      background-color: #238636;
      color: white;
      padding: 12px 24px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 0 10px rgba(35, 134, 54, 0.7);
      width: 100%;
      max-width: 300px;
    }
    button:hover {
      background-color: #2ea043;
    }
    .command-list {
      text-align: left;
      margin-top: 20px;
      font-size: 0.9rem;
    }
    .command-list h3 {
      color: #58a6ff;
      margin-bottom: 10px;
    }
    .command-list ul {
      padding-left: 20px;
    }
    .command-list li {
      margin-bottom: 8px;
    }
    .status {
      font-size: 0.8rem;
      color: #8b949e;
      margin-top: 10px;
    }
    .user {
      color: #58a6ff;
      margin-bottom: 8px;
    }
    .jarvis {
      color: #3fb950;
      margin-bottom: 8px;
    }
    .error {
      color: #ff7b72;
      margin-bottom: 8px;
    }
    .pulse {
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(35, 134, 54, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(35, 134, 54, 0); }
      100% { box-shadow: 0 0 0 0 rgba(35, 134, 54, 0); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Welcome back, Sir â€” I'm Jarvis 2.0</h1>
    <p>Your personal AI assistant. Speak commands in English or Hinglish.</p>
    <button id="micButton" class="pulse" onclick="startJarvis()">ðŸŽ¤ Start Jarvis</button>
    <div id="status" class="status">Initializing...</div>
    <div id="response">Jarvis: Loading services...</div>
    
    <div class="command-list">
      <h3>Try these commands:</h3>
      <ul>
        <li>"Open YouTube"</li>
        <li>"Play music" or "Play lofi"</li>
        <li>"What's the time?"</li>
        <li>"Show me the news"</li>
        <li>"Who is the CM of Haryana?"</li>
        <li>"How are you?" or "Kaise ho?"</li>
        <li>"Stop listening" to deactivate</li>
      </ul>
    </div>
  </div>

  <script>
    const synth = window.speechSynthesis;
    const responseBox = document.getElementById('response');
    const statusElement = document.getElementById('status');
    const micButton = document.getElementById('micButton');
    
    let recognition;
    let isListening = false;
    let isInitialized = false;

    function initializeJarvis() {
      return new Promise((resolve) => {
        // Check for speech synthesis support
        if (!synth) {
          statusElement.textContent = "Error: Speech synthesis not supported";
          responseBox.innerHTML += '<div class="error">Your browser doesn\'t support speech synthesis</div>';
          return resolve(false);
        }

        // Check for speech recognition support
        if (!('webkitSpeechRecognition' in window) {
          statusElement.textContent = "Error: Speech recognition not supported";
          responseBox.innerHTML += '<div class="error">Your browser doesn\'t support speech recognition</div>';
          return resolve(false);
        }

        // Load voices
        let voicesLoaded = false;
        const loadVoices = () => {
          const voices = synth.getVoices();
          if (voices.length > 0) {
            voicesLoaded = true;
            resolve(true);
          }
        };

        if (synth.getVoices().length > 0) {
          voicesLoaded = true;
          resolve(true);
        } else {
          synth.onvoiceschanged = loadVoices;
          setTimeout(() => {
            if (!voicesLoaded) {
              statusElement.textContent = "Warning: Voice loading delayed";
              resolve(true); // Continue even if voices take time
            }
          }, 1000);
        }
      });
    }

    function speak(text) {
      if (!synth) return;
      
      if (synth.speaking) {
        synth.cancel();
      }
      
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'en-IN';
      utter.rate = 1.0;
      utter.pitch = 0.9;
      
      // Try to find a male voice
      const voices = synth.getVoices();
      const maleVoice = voices.find(v => v.name.includes('Male') || v.lang.includes('en-IN'));
      if (maleVoice) {
        utter.voice = maleVoice;
      }
      
      synth.speak(utter);
    }

    function startListening() {
      try {
        recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-IN';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        
        recognition.onstart = function() {
          isListening = true;
          micButton.textContent = "ðŸ›‘ Stop Listening";
          statusElement.textContent = "Listening...";
          responseBox.innerHTML += '<div class="user">You: Listening...</div>';
          scrollToBottom();
        };
        
        recognition.onresult = function(event) {
          const command = event.results[0][0].transcript;
          responseBox.innerHTML += `<div class="user">You: ${command}</div>`;
          scrollToBottom();
          handleCommand(command.toLowerCase());
        };
        
        recognition.onerror = function(event) {
          console.error("Recognition error:", event.error);
          if (event.error === 'not-allowed') {
            responseBox.innerHTML += '<div class="error">Microphone access denied. Please enable permissions.</div>';
            speak("Sir, I need microphone permissions to work properly.");
          } else {
            responseBox.innerHTML += `<div class="error">Error: ${event.error}</div>`;
          }
          stopListening();
          scrollToBottom();
        };
        
        recognition.onend = function() {
          if (isListening) {
            recognition.start();
          }
        };
        
        recognition.start();
      } catch (error) {
        console.error("Recognition init error:", error);
        responseBox.innerHTML += '<div class="error">Error initializing speech recognition</div>';
        scrollToBottom();
      }
    }

    function stopListening() {
      if (recognition) {
        recognition.stop();
      }
      isListening = false;
      micButton.textContent = "ðŸŽ¤ Start Listening";
      statusElement.textContent = "Ready";
      responseBox.innerHTML += '<div class="user">You: Stopped listening</div>';
      scrollToBottom();
    }

    function scrollToBottom() {
      responseBox.scrollTop = responseBox.scrollHeight;
    }

    function handleCommand(command) {
      let response = "";

      if (command.includes("youtube") || command.includes("open youtube")) {
        response = "Opening YouTube, Sir.";
        setTimeout(() => window.open("https://www.youtube.com", "_blank"), 1000);

      } else if (command.includes("lofi") || command.includes("play music") || command.includes("gaana chalao")) {
        response = "Playing relaxing music, Sir.";
        setTimeout(() => window.open("https://www.youtube.com/watch?v=jfKfPfyJRdk", "_blank"), 1000);

      } else if (command.includes("time") || command.includes("samay") || command.includes("kitne baje")) {
        const now = new Date();
        response = `It is ${now.toLocaleTimeString('en-IN', {hour: '2-digit', minute:'2-digit'})}`;

      } else if (command.includes("news") || command.includes("current affairs") || command.includes("khabar")) {
        response = "Fetching today's news...";
        setTimeout(() => window.open("https://www.google.com/search?q=current+affairs", "_blank"), 1500);

      } else if (command.includes("cm of haryana") || command.includes("haryana cm") || command.includes("haryana ka mukhyamantri")) {
        response = "The Chief Minister of Haryana is Shri Nayab Singh Saini.";

      } else if (command.includes("remind me") || command.includes("yaad dila")) {
        response = "Reminder noted, Sir. Although I can't set system alarms yet.";

      } else if (command.includes("how are you") || command.includes("kaisa hai") || command.includes("kaise ho")) {
        response = "I'm functioning perfectly, Sir. Ready to assist.";

      } else if (command.includes("stop") || command.includes("band karo") || command.includes("ruk jao")) {
        response = "Stopping as requested, Sir.";

      } else if (command.includes("thank you") || command.includes("dhanyavaad") || command.includes("shukriya")) {
        response = "You're welcome, Sir. Always happy to assist.";

      } else {
        response = "I didn't understand that command yet, Sir. Please try something else.";
      }

      speak(response);
      responseBox.innerHTML += `<div class="jarvis">Jarvis: ${response}</div>`;
      scrollToBottom();
    }

    async function startJarvis() {
      if (!isInitialized) {
        micButton.disabled = true;
        statusElement.textContent = "Initializing services...";
        
        const initialized = await initializeJarvis();
        if (!initialized) {
          micButton.disabled = false;
          return;
        }
        
        isInitialized = true;
        statusElement.textContent = "Ready";
        responseBox.innerHTML = '<div class="jarvis">Jarvis: Hello Sir, how may I assist you today?</div>';
        speak("Hello Sir, Jarvis at your service. How may I assist you today?");
      }
      
      if (isListening) {
        stopListening();
      } else {
        startListening();
      }
    }

    // Initial setup
    window.onload = function() {
      // Check if we're running on HTTPS (required for microphone access)
      if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
        responseBox.innerHTML = '<div class="error">Warning: Microphone access requires HTTPS or localhost</div>';
      }
    };
  </script>
</body>
</html>
